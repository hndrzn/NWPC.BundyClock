@page "/autocomplete"
@inject IEmployeeServices EmployeeService

<link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />

<MudGrid>
    <MudItem xs="12" sm="6" md="4">
        <MudAutocomplete T="string" Label="Search Employee" @bind-Value="value" SearchFunc="@SearchEmployees"
                         AdornmentIcon="@Icons.Material.Filled.Search" AdornmentColor="Color.Primary" />
    </MudItem>
    <MudItem xs="12" md="12">
        <MudText Class="mb-n3" Typo="Typo.body2">
            <MudChip>@(value ?? "Not selected")</MudChip>
        </MudText>
    </MudItem>
</MudGrid>

@code {
    public string? value;
    public List<EmployeeData>? Employees;

    protected override async Task OnInitializedAsync()
    {
        Employees = await EmployeeService.GetAllEmployees();
    }

    public async Task<IEnumerable<string?>> SearchEmployees(string? searchText)
    {
        await Task.Delay(5);

        if (string.IsNullOrEmpty(searchText) || Employees == null)
            return new List<string>();

        return Employees.Where(employee => employee.EmployeeName.Contains(searchText, StringComparison.InvariantCultureIgnoreCase))
                        .Select(employee => employee.EmployeeName);

    }
}
